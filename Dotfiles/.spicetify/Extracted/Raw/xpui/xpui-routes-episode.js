"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[472],{99922:(e,t,n)=>{n.d(t,{o:()=>l});var a=n(17231),i=n(44503);function l(){return{version:(0,a.W6)(i.GE)?2:1}}},36091:(e,t,n)=>{n.r(t),n.d(t,{Episode:()=>Be,default:()=>ze,parseReleaseDate:()=>We});var a=n(67294),i=n.n(a),l=n(65858),r=n(61202),s=n(20657),o=n(69518),d=n.n(o),c=n(62975),m=n(67154),u=n.n(m),p=n(28248),k=n(76343),v=n(28120),g=n(38470),y=n(74600),E=n(54280);const h=({uri:e,segmentCount:t})=>{const n=(0,E.G)(),l=(0,a.useCallback)((async(t,a)=>{const i=Math.ceil(t/2);try{return function(e,t,n){return e.reduce(((e,a,i)=>((i>0||t>0)&&e.push({type:"SPACER",id:`spacer-${e.length}`}),"MUSIC"===a.type?e.push(function(e,t,n){return{type:"MUSIC",index:t,uri:n.uri,episodeUri:e,start:n.start,stop:n.stop,duration:n.duration,name:n.track.name,artists:n.track.artists,album:n.track.album,playable:n.track.playable}}(n,i,a)):"TALK"===a.type&&e.push(function(e,t,n){return{type:"TALK",index:t,uri:e,title:n.title,subtitle:n.subtitle,start:n.start,stop:n.stop,duration:n.duration,showUri:n.show.uri,showName:n.show.name}}(n,i,a)),e)),[])}(await n.getSegments(e,i,a),i,e)}catch(e){return[]}}),[n,e]),r=(0,a.useCallback)((t=>{switch(t.type){case"SPACER":return i().createElement("div",{key:t.id,className:v.Z.spacerRow});case"MUSIC":return i().createElement(p.Z,u()({key:`${e}-${t.index}`},t));case"TALK":return i().createElement(y.t,u()({key:`${e}-${t.index}`},t));default:return(0,g.U)(t)}}),[e]),o=s.ag.get("music_and_talk.in_this_episode");return i().createElement("div",null,i().createElement(k.Dy,{as:"h2",variant:k.$e.canon,color:"var(--spice-text)",className:v.Z.header},o),i().createElement(p.Pv,{ariaLabel:o,hasHeaderRow:!0,rowPlaceholder:p.hU,columns:[p.QD.TITLE,p.QD.ALBUM_OR_SHOW,p.QD.DURATION],renderRow:r,fetchTracks:l,resolveUri:e=>"MUSIC"===e.type?e.uri:"",limit:50,nrTracks:2*t-1,testID:"music-and-talk-tracklist"}))};var b=n(44503),S=n(1663),f=n(37483);const P="Ck11dU0ipD52SdUcCdl3",N="EzPp2M6sPnJCpwd8Jbi7",U="WL5zy4E6QItBeCT6BdYq",w="HXLKjt4pA15hJqLJxnWA",C="FdpyBxDdNrrL27wrINsy",D="QJPX1kGtuCNg6EUL2LAS";var I=n(92408),A=n(56802),F=n(42273),L=n(20238),M=n(7073),R=n(20246),x=n(25988),T=n(95661),_=n(43620),B=n(18261),z=n(99922),W=n(74849);const O=(0,a.lazy)((()=>n.e(396).then(n.bind(n,88396))));function $(e){const t=(0,W.m)(),n=(0,z.o)();return t?i().createElement(a.Suspense,{fallback:!0},i().createElement(O,u()({reason:"Episode page"},n,e))):null}var K=n(51871),X=n(11414),Y=n(30947),q=n(17231),V=n(67892),Z=n(84242),G=n(38894),Q=n(94184),J=n.n(Q),H=n(4348);const j="axX_dOb7KXxh2BhADfuQ",ee="DIz7crU76YDtXXLx34nF",te="R2a58pDnuIWBldpbVPRr",ne=i().memo((({title:e,episodes:t,className:n})=>i().createElement("div",{className:J()(j,n)},i().createElement(k.Dy,{as:"h2",variant:k.Dy.canon,className:ee},e),i().createElement("div",{className:te},t.map(((e,t)=>i().createElement(H.B,{key:e.id,entity:e,index:t})))))));var ae=n(98984);const ie={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"getRecommendedEpisodes"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"uri"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"limit"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"episode"},arguments:[{kind:"Argument",name:{kind:"Name",value:"uri"},value:{kind:"Variable",name:{kind:"Name",value:"uri"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"recommendedEpisodes"},arguments:[{kind:"Argument",name:{kind:"Name",value:"limit"},value:{kind:"Variable",name:{kind:"Name",value:"limit"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"items"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"episode"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"uri"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"releaseDate"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isoString"}}]}},{kind:"Field",name:{kind:"Name",value:"duration"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"totalMilliseconds"}}]}},{kind:"Field",name:{kind:"Name",value:"contentRating"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"label"}}]}},{kind:"Field",name:{kind:"Name",value:"coverArt"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"sources"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"}},{kind:"Field",name:{kind:"Name",value:"width"}},{kind:"Field",name:{kind:"Name",value:"height"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"podcast"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"coverArt"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"sources"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"}},{kind:"Field",name:{kind:"Name",value:"width"}},{kind:"Field",name:{kind:"Name",value:"height"}}]}}]}}]}}]}}]}}]}}]}}]}}]},le=({uri:e,limit:t})=>{var n;const{data:l}=(r={uri:e,limit:t},o={cacheTime:15*ae.y},(0,ae.a)(ie,r,o));var r,o;const d=(0,a.useMemo)((()=>{var e;return((null==l||null===(e=l.episode)||void 0===e?void 0:e.recommendedEpisodes.items)||[]).map((e=>{var t,n,a,i,l,r,s;return{id:e.episode.id,uri:e.episode.uri,name:e.episode.name,description:null!==(t=e.episode.description)&&void 0!==t?t:"",explicit:(null===(n=e.episode.contentRating)||void 0===n?void 0:n.label)===M.KS.Explicit,release_date:We(null===(a=e.episode.releaseDate)||void 0===a?void 0:a.isoString),duration_ms:e.episode.duration.totalMilliseconds,images:null!==(i=null===(l=e.episode.coverArt)||void 0===l?void 0:l.sources)&&void 0!==i?i:[],show:{images:null!==(r=null===(s=e.episode.podcast.coverArt)||void 0===s?void 0:s.sources)&&void 0!==r?r:[]}}}))}),[null==l||null===(n=l.episode)||void 0===n?void 0:n.recommendedEpisodes.items]);return(null==d?void 0:d.length)>0?i().createElement(ne,{title:s.ag.get("mwp.entity.might.like"),episodes:d}):null};var re=n(8341),se=n(62890),oe=n(23716),de=n(68107),ce=n(70369),me=n(34325),ue=n(57978),pe=n(84629),ke=n(84788),ve=n(59482),ge=n(72907),ye=n(55911),Ee=n(46245),he=n(72917),be=n(95806),Se=n(18061),fe=n(8247);const Pe="activation-trigger-mme",Ne=({episodeUri:e,showUri:t,isLocked:n,isPlaying:a,isPlayDisabled:r,playButtonPlayLabel:s,playButtonPauseLabel:o,onClick:c})=>{const m=(0,l.v9)((e=>{var t;return null===(t=e.platform)||void 0===t?void 0:t.isBrowser})),u=i().createElement(be.l,{showUri:t,enabled:n},i().createElement(Se.F,{property:fe.iY,renderOldExperience:()=>i().createElement(ye.JM,{size:ye.qE.lg,onClick:c,isPlaying:a,disabled:r,locked:n,ariaPlayLabel:s,ariaPauseLabel:o}),renderNewExperience:()=>i().createElement(Ee.fh,{size:"lg",onClick:c,isPlaying:a,disabled:r,locked:n,ariaPlayLabel:s,ariaPauseLabel:o})}));return m?i().createElement(he.c,{id:Pe,targetURI:d().from(e)},u):u};var Ue=n(86649),we=n(192);const Ce="UVWRbDQd2DM0ShkvMq54",De="Eoy1M3AAKeAUI9cNWsuq",Ie="rmgkmccGmTBvrw7gXMyS";var Ae=n(5944),Fe=n(32626),Le=n(31610);function Me(e){return(null==e?void 0:e.replace(/T.*/,""))||""}function Re(e){const t=d().from(e);return`/show/${d().hexToId((null==t?void 0:t.id)||"")}`}const xe=i().memo((({chapter:e})=>{var t;const{name:n,uri:r,sharingInfo:o,playedState:d,contentRating:c,duration:m,releaseDate:u,playability:p}=e,k=e.book,v=e.coverArt.length?e.coverArt:k.coverArt||[],g=null===(t=v[0])||void 0===t?void 0:t.url,y=(0,_.Z)(g||null),E=s.ag.get("types.chapter"),h=(0,l.I0)(),[b,S]=(0,a.useState)(d.state===M.sY.Completed),{triggerPlay:f,togglePlay:P,isPlaying:N,isActive:U}=(0,Z.n)({uri:r},{featureIdentifier:"episode"}),w=(0,re.Y)((e=>{var t;return null!==(t=(0,Ae.k)(e))&&void 0!==t?t:void 0})),C=!p.playable&&p.reason===Ue.WY.PaymentRequired,{badges:D}=(0,ke.r)({contentRating:null==c?void 0:c.label}),A=(0,a.useCallback)((e=>{!p.playable&&D.nineteen&&(e.stopPropagation(),h((0,pe.RM)(r||"")))}),[r,p.playable,D.nineteen,h]),L=(0,a.useCallback)((e=>{C||(U?P():f({seekTo:e}))}),[C,U,P,f]);(0,a.useEffect)((()=>{const e=new URLSearchParams(location.search);if(e.has("t")){const t=e.get("t")||"0",n=1e3*parseInt(t,10);n<=m.milliseconds&&L(n)}}),[m,L]);const R=!C&&!p.playable,z=k.uri,W=k.name,O=s.ag.get("tracklist.a11y.play",n,W),$=s.ag.get("tracklist.a11y.pause",n,W);return i().createElement("section",{"data-testid":"chapter",className:Ce},i().createElement(F.gF,{backgroundColor:y},i().createElement(ve.W,null,i().createElement(ge.i,{text:n})),i().createElement("div",{className:Ie},i().createElement(B._,{menu:i().createElement(x.k,{uri:r,sharingInfo:o,showUri:z,contextUri:r,isPlayed:b,onMarkAsPlayed:S})},i().createElement(F.Oe,{loading:"eager",name:n,images:v,placeholderType:"episode",shape:F.Kc.ROUNDED_CORNERS}))),i().createElement(F.sP,null,i().createElement(F.dy,{small:!0,uppercase:!0},E),i().createElement(B._,{menu:i().createElement(x.k,{uri:r,sharingInfo:o,showUri:z,contextUri:r,isPlayed:b,onMarkAsPlayed:S})},i().createElement(F.xd,{dragUri:r,dragLabel:n},i().createElement("span",{"data-testid":"chapterTitle"},n))),i().createElement(B._,{menu:i().createElement(x.k,{uri:r,sharingInfo:o,showUri:z,contextUri:r,isPlayed:b,onMarkAsPlayed:S})},i().createElement(V.Z,{to:Re(z)},i().createElement(F.dy,{large:!0,bold:!0},i().createElement("span",{"data-testid":"bookTitle"},W)))))),i().createElement(Y.o,{backgroundColor:y},i().createElement(Y.F,null,D.nineteen&&i().createElement(ue.X,{className:De,size:16}),i().createElement(I.E,{size:I.$.LARGE,fullyPlayed:b,durationMs:m.milliseconds,releaseDate:Me(null==u?void 0:u.isoString),resumePositionMs:d.playPositionMilliseconds,isPlaying:N,position:U&&w||void 0})),i().createElement(Y.F,null,i().createElement("div",{onClick:A},i().createElement(Ne,{episodeUri:r,showUri:z,isLocked:C,onClick:()=>{L(d.playPositionMilliseconds)},isPlaying:N,isPlayDisabled:R,playButtonPlayLabel:O,playButtonPauseLabel:$})),!C&&i().createElement(Le.o,{uri:r,bookUri:z}),i().createElement(Fe.yj,{menu:i().createElement(x.k,{uri:r,sharingInfo:o,showUri:z,contextUri:r,isPlayed:b,onMarkAsPlayed:S})},i().createElement(T.z,{label:s.ag.get("more.label.context",n)})))))}));var Te=n(52759);function _e(e){const t=d().from(e);return`/show/${d().hexToId((null==t?void 0:t.id)||"")}`}const Be=({episode:e})=>{var t,n,o,m,u,p,v,g;const{uri:y,name:E,sharingInfo:S,playedState:z,episodeType:W,description:O,htmlDescription:Q,podcastSubscription:J,contentRating:H,segmentsCount:j,playability:ee,coverArt:te,releaseDate:ne,podcast:ae}=e,ie=(0,r.TH)(),ye=(0,l.I0)(),Ee=(0,oe.g)(),he=(0,A.o)(),be=(0,q.W6)(b.Cz),[Se,fe]=(0,a.useState)(z.state===M.sY.Completed),Ue=(0,q.W6)(b.Be),we=void 0!==j&&j>0&&Ue,Ce=(0,G.g)(),{triggerPlay:De,togglePlay:Ie,isPlaying:Ae,isActive:Fe}=(0,Z.n)({uri:y},{featureIdentifier:"episode"}),[Le]=(0,Te.z)(1e4,(e=>{var t;return(null==e||null===(t=e.item)||void 0===t?void 0:t.uri)===y})),Me=(0,re.Y)((e=>{var t;return null!==(t=null==e?void 0:e.isPaused)&&void 0!==t?t:void 0})),Re=function(e,t,n,a,l){const r=t===M.Wf.Episode;return(0,me.G3)(e,a,n,l)?i().createElement(me.Fg,{isMusicAndTalk:r}):r?s.ag.get("type.showEpisode"):s.ag.get("type.podcastEpisode")}(y,W||M.Wf.Unknown,z.playPositionMilliseconds,We(null==ne?void 0:ne.isoString),z.state===M.sY.Completed),xe=te[0].url,Be=(0,_.Z)(xe||null),ze=(0,l.v9)((e=>{var t;return null===(t=e.platform)||void 0===t?void 0:t.isBrowser})),Oe=J.isPaywalled&&!J.isUserSubscribed,$e=(0,de.s)(e,ae),{badges:Ke}=(0,ke.r)({contentRating:null==H?void 0:H.label}),Xe=(0,a.useCallback)((e=>{!ee.playable&&Ke.nineteen&&(e.stopPropagation(),ye((0,pe.RM)(y||"")))}),[y,ee.playable,Ke.nineteen,ye]),Ye=(0,a.useCallback)(((e,t=!0)=>{if(Oe)return;let n="play";!Ae||0!==e&&t||(n="pause"),he({intent:n,targetUri:y,type:"click",itemIdSuffix:e>0?"podcast-description-timestamp":"button"}),W===M.Wf.Episode&&ze?c.y.set((()=>({triggerId:Pe,triggerAction:null}))):Fe&&!t?Ce?Me?Ee.resume():Ee.pause():Ie():Ce?$e({seekTo:e}):De({seekTo:e})}),[Oe,Ae,he,y,W,ze,Fe,Ce,Me,Ee,Ie,$e,De]),qe=(0,a.useCallback)((()=>{he({intent:"expand-description",type:"click"})}),[he]),Ve=O||be&&Q;(0,a.useEffect)((()=>{if(e){const t=new URLSearchParams(ie.search);if(t.has("t")){const n=t.get("t")||"0",a=1e3*parseInt(n,10);a<=e.duration.milliseconds&&Ye(a)}}}),[e]);const Ze=!Oe&&!e.playability.playable,Ge=s.ag.get("tracklist.a11y.play",e.name,null===(t=e.podcast)||void 0===t?void 0:t.name),Qe=s.ag.get("tracklist.a11y.pause",e.name,null===(n=e.podcast)||void 0===n?void 0:n.name),Je=null===(o=e.podcast)||void 0===o?void 0:o.uri,He=null===(m=d().from(Je))||void 0===m?void 0:m.toURLPath(!0);return i().createElement("section",{"data-testid":"episode",className:P},i().createElement(ce.$,null,s.ag.get("podcasts.episode.seo.title",{name:e.name,show:null!==(u=null===(p=e.podcast)||void 0===p?void 0:p.name)&&void 0!==u?u:""})),i().createElement(F.gF,{backgroundColor:Be},i().createElement(ve.W,null,i().createElement(ge.i,{text:e.name,dragUri:y,dragLabel:e.name})),i().createElement("div",{className:D},i().createElement(B._,{menu:i().createElement(x.k,{uri:e.uri,sharingInfo:e.sharingInfo,showUri:Je,contextUri:e.uri,isPlayed:Se,onMarkAsPlayed:fe})},i().createElement(F.Oe,{loading:"eager",name:e.name,images:e.coverArt,placeholderType:"episode",shape:F.Kc.ROUNDED_CORNERS}))),i().createElement(F.sP,null,i().createElement(F.dy,{small:!0,uppercase:!0},Re),i().createElement(B._,{menu:i().createElement(x.k,{uri:y,sharingInfo:S,showUri:Je,contextUri:y,isPlayed:Se,onMarkAsPlayed:fe})},i().createElement(F.xd,{dragUri:y,dragLabel:E},i().createElement("span",{"data-testid":"episodeTitle"},E))),i().createElement(B._,{menu:i().createElement(x.k,{uri:e.uri,sharingInfo:e.sharingInfo,showUri:Je,contextUri:e.uri,isPlayed:Se,onMarkAsPlayed:fe})},i().createElement(V.Z,{to:_e(Je)},i().createElement(F.dy,{large:!0,bold:!0},i().createElement("span",{"data-testid":"showTitle"},null===(v=e.podcast)||void 0===v?void 0:v.name)))))),i().createElement(Y.o,{backgroundColor:Be},i().createElement(Y.F,null,Ke.nineteen&&i().createElement(ue.X,{className:C,size:16}),i().createElement(I.E,{size:I.$.LARGE,fullyPlayed:Se,durationMs:e.duration.milliseconds,releaseDate:We(null===(g=e.releaseDate)||void 0===g?void 0:g.isoString),resumePositionMs:z.playPositionMilliseconds,isPlaying:Ae,position:Fe&&Le||void 0})),i().createElement(Y.F,null,i().createElement("div",{onClick:Xe},i().createElement(Ne,{episodeUri:e.uri,showUri:Je,isLocked:Oe,onClick:()=>{Ye(z.playPositionMilliseconds,!1)},isPlaying:Ae,isPlayDisabled:Ze,playButtonPlayLabel:Ge,playButtonPauseLabel:Qe})),!Oe&&i().createElement(f.p,{uri:e.uri,showUri:Je}),i().createElement(K.w,{uri:e.uri,size:X.q.md}),i().createElement(R.y,{menu:i().createElement(x.k,{uri:e.uri,sharingInfo:e.sharingInfo,showUri:Je,contextUri:e.uri,isPlayed:Se,onMarkAsPlayed:fe})},i().createElement(T.z,{label:s.ag.get("more.label.context",e.name)})))),i().createElement("div",{className:"contentSpacing"},Ve&&i().createElement(i().Fragment,null,i().createElement(k.Dy,{as:"h2",variant:k.$e.canon,color:"var(--spice-text)",className:U},s.ag.get("episode.description-title")),i().createElement(L.o,{className:N,onTimeStampClick:Ye,maxLines:4,onExpanded:qe,content:(e.description||"").trim(),htmlContent:be&&e.htmlDescription?e.htmlDescription:void 0,LinkComponent:V.Z,enableTimestamps:e.playability.playable})),we&&i().createElement(h,{segmentCount:j,uri:e.uri}),He&&i().createElement(se.z,{version:"outlined",linkTo:He,className:w},s.ag.get("episode.see_all_episodes")),i().createElement($,{uri:y}),i().createElement(le,{uri:y,limit:6})))},ze=i().memo((()=>{const{episodeId:e}=(0,r.UO)(),t=function(e,t){const[n,i]=(0,a.useState)(null),l=(0,we.z)();return(0,a.useEffect)((()=>{l.getEpisodeOrChapter(e,t).then((e=>{i(e)}))}),[l,e,t]),n}(d().episodeURI(e).toURI(),(0,q.W6)(b.uB));return t?(0,Ue.Ey)(t)?i().createElement(a.Suspense,{fallback:null},i().createElement(xe,{chapter:t})):i().createElement(a.Suspense,{fallback:null},i().createElement(Be,{episode:t})):i().createElement(S.h,{errorMessage:s.ag.get("error.not_found.title.podcast")})}));function We(e){return(null==e?void 0:e.replace(/T.*/,""))||""}}}]);
//# sourceMappingURL=xpui-routes-episode.js.map