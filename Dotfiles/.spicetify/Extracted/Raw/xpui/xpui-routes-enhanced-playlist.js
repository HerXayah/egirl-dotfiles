"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[682],{45685:(e,t,n)=>{n.r(t),n.d(t,{EnhancedPlaylist:()=>pe,default:()=>ye});var a=n(59713),l=n.n(a),r=n(95661),i=n(13020),c=n(70369),s=n(55120),o=n(83979),u=n(20657),m=n(67294),d=n.n(m),p=n(30947),y=n(55911),b=n(20246),v=n(43620),f=n(84242),g=n(6479),E=n.n(g),h=n(47991),x=n(56705),I=n(80624),k=n(25237),w=n(94967),P=n(69518),O=n.n(P),C=n(11680),R=n(45287),j=n(17231),T=n(8247);const N=["pageItems"];function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function D(e){const t=(0,C._)(),{isEnhanced:n,iteration:a,setIsEnhanced:l,toggleIsEnhanced:r}=(0,R.U)(e),i=(0,j.W6)(T.HT);let c=e;if(O().isPlaylistV1OrV2(e)){const t=O().from(e).getBase62Id();c=i?`spotify:enhanced:playlist:${t}`:`spotify:dynamic-playlist-session:${t}`}else i&&O().isCollection(e)&&(c="spotify:enhanced:collection:tracks");const[s,o]=(0,m.useState)(null),u=(0,m.useRef)({}),d=(0,m.useRef)(null),p=(0,m.useMemo)((()=>new w.Ct),[]),y=(0,m.useMemo)((()=>new w.tL),[]),b=(0,m.useCallback)((async e=>{const t=Array.from(new Set(e.map((e=>e.uri)))).filter((e=>!p.has(e)));return(await(0,x.s)(t,(async e=>{const t=e.map((e=>O().from(e).getBase62Id())),{body:n}=await y.create(t.join(","),(()=>k.fQ.getTracks(I.b.getInstance(),t)));return n.tracks}))).flat().forEach((e=>p.set((0,h.$V)(e),e))),n=p,e.map((e=>{var t;return U(U({},n.get(e.uri)),{},{uid:null==e?void 0:e.itemId,isEnhanced:null==e||null===(t=e.itemAttributes)||void 0===t?void 0:t.isRecommendation})}));var n}),[p,y]),v=(0,m.useCallback)((async(e,n,a,l,r,i)=>{var c,s,m,p,y,v,f;const g=null===(c=d.current)||void 0===c?void 0:c.stateId;let h;try{h=await i}catch(r){409===(null==r?void 0:r.status)&&(h=await t.getPage(e,n,a,l))}const x=null===(s=h)||void 0===s?void 0:s.enhancePage;if(!x)return[];const{pageItems:I}=x,k=E()(x,N),w=await b(I);if(g!==(null===(m=d.current)||void 0===m?void 0:m.stateId))return[];const P=(null===(p=d.current)||void 0===p?void 0:p.contextRevision)!==k.contextRevision,O=(null===(y=d.current)||void 0===y?void 0:y.sessionId)!==k.sessionId;(P||O)&&(r=!0),u.current=function(e,t,n,a){const l=a?{}:U({},e);return t.forEach(((e,t)=>{l[n+t]=e})),l}(u.current,w,a,r);const C=(null!==(v=null===(f=d.current)||void 0===f?void 0:f.stateId)&&void 0!==v?v:1)+(r?1:0),R=U(U({},k),{},{stateId:C});return o(R),d.current=R,w}),[b,t]),f=(0,m.useCallback)((async({itemIds:n,offset:l=0,limit:r=1})=>{d.current&&a&&v(e,a,l,r,!0,t.addRecommendation(e,d.current.sessionId,d.current.contextRevision,n,l,r))}),[v,e,t,a]),g=(0,m.useCallback)((async({itemIds:n,offset:l=0,limit:r=1})=>{d.current&&a&&v(e,a,l,r,!0,t.removeRecommendation(e,d.current.sessionId,d.current.contextRevision,n,l,r))}),[v,e,t,a]),P=(0,m.useCallback)((async(n,l)=>{var r;if(!a)return[];const i=Math.min(l,((null===(r=d.current)||void 0===r?void 0:r.numTotalItems)||1/0)-n),c=Array.from({length:i},((e,t)=>u.current[t+n]));return c.every((e=>!!e))?c:v(e,a,n,l,!1,t.getPage(e,a,n,l))}),[v,e,t,a]);return{isEnhanced:n,setIsEnhanced:l,toggleIsEnhanced:r,addRecommendation:f,removeRecommendation:g,playContext:(0,m.useMemo)((()=>({uri:c,url:null==s?void 0:s.dspContextUri})),[c,null==s?void 0:s.dspContextUri]),numTotalItems:isNaN(Number(null==s?void 0:s.numTotalItems))?void 0:Number(null==s?void 0:s.numTotalItems),numTotalRecs:isNaN(Number(null==s?void 0:s.numTotalRecs))?void 0:Number(null==s?void 0:s.numTotalRecs),fetchTracks:P,stateId:null==s?void 0:s.stateId}}var M=n(32567);const S={xs:"(min-width: 0px)",xsOnly:"(min-width: 0px) and (max-width: 767px)",sm:"(min-width: 768px)",smOnly:"(min-width: 768px) and (max-width: 1023px)",md:"(min-width: 1024px)",mdOnly:"(min-width: 1024px) and (max-width: 1279px)",lg:"(min-width: 1280px)",lgOnly:"(min-width: 1280px) and (max-width: 1919px)",xl:"(min-width: 1920px)",enhancedPlaylist:"OfFtIpc_qctF95n1Xk6p",playlistImageContainer:"q91bEN94vb8qNievR8JN"};var A=n(4236),L=n(42922),F=n(49961),z=n(35308),Z=n(28248),$=n(73785),B=n(44461),Q=n(9296),X=n(52284),q=n(32626),G=n(65095),V=n(87257),W=n(57978),H=n(75016),J=n(24656),K=n(84788),Y=n(86213),ee=n(94184),te=n.n(ee);const ne="TRDgmejiOzKjissuLFSx";var ae=n(83692);const le=({onClick:e=(()=>{}),className:t,label:n,ariaLabel:a=n,Icon:l})=>d().createElement(ae.w,{label:n},d().createElement("button",{type:"button","aria-label":a,className:te()(ne,t),onClick:e},d().createElement(l,{iconSize:16})));var re=n(27481),ie=n(83384),ce=n(82760);const se=d().memo((function({uri:e,uid:t,name:n,durationMs:a,artists:l,album:r,isMOGEFRestricted:i,isExplicit:c,isPlayable:s,index:o,playIndex:p=null,imgUrl:y,contextUri:b,usePlayContextItem:v,isEnhanced:f,add:g,remove:E}){var h;const{useCurrentAvailability:x}=(0,m.useContext)(J.I),[I,k]=x(e),w=s&&I,{badges:P,hasBadges:O}=(0,K.r)({offlineAvailability:k,isExplicit:c,isMOGEFRestricted:i,isEnhanced:f}),C=o+1,R=d().createElement(Y.$,{uri:e,uid:t,albumUri:null==r?void 0:r.uri,artists:l,contextUri:b,isRecommendation:f,removePlaylistItems:()=>E(t),removeRecommendation:()=>E(t),addRecommendation:()=>g(t)}),j=(null==l?void 0:l.map((e=>e.name)).join(u.ag.getSeparator()))||"",{isActive:T,isPlaying:N,triggerPlay:_,togglePlay:U}=v({uid:t,uri:e,index:null!=p?p:o});return d().createElement(L.ZP,{value:"row",index:o},d().createElement(q._P,{menu:R},d().createElement(ce.c,{uri:e,contextUri:b,index:o,onTriggerPlay:()=>{_()},isActive:T,ariaRowIndex:o+1,isPlayable:w,ageRestricted:i,dragMetadata:{name:n,createdBy:j}},d().createElement(re.Dd,{ariaColIndex:0},d().createElement(re.Du,{playAriaLabel:u.ag.get("tracklist.a11y.play",n,j),onClick:()=>{U()},isPlaying:N},d().createElement(re.km,null,C))),d().createElement(re.vZ,{ariaColIndex:1},d().createElement(re.lD,{src:y}),d().createElement(re.vm,null,d().createElement(re.Wh,null,n),O&&d().createElement(re.g3,null,P.enhanced&&d().createElement(B.J,{iconSize:16,className:ie.Z.enhanced,"aria-label":u.ag.get("web-player.enhance.button_text_enhanced")}),P.download&&d().createElement(G.G,{size:16}),P.explicit&&d().createElement(V.N,null),P.paid&&d().createElement(H.g,null),P.nineteen&&d().createElement(W.X,{className:ie.Z.nineteen,size:16})),d().createElement(re.K9,null,d().createElement(re.T6,{artists:l})))),d().createElement(re.UA,{ariaColIndex:2},d().createElement(re.BM,{uri:r.uri,name:r.name,creatorUri:null==l||null===(h=l[0])||void 0===h?void 0:h.uri},r.name)),d().createElement(re.mU,{ariaColIndex:3},!!f&&d().createElement(d().Fragment,null,d().createElement(le,{onClick:()=>g(t),label:u.ag.get("web-player.enhance.button_label_keep_in_playlist"),Icon:Q.Z}),d().createElement(le,{onClick:()=>E(t),label:u.ag.get("web-player.enhance.button_label_remove_from_playlist"),Icon:X.w})),d().createElement(re.A$,{duration:a}),d().createElement(re.Zv,{menu:R,label:u.ag.get("more.label.track",n,j)})))))})),oe=[$.Q.INDEX,$.Q.TITLE,$.Q.ALBUM,$.Q.DURATION],ue=d().memo((function({ariaLabel:e,uri:t,name:n,usePlayContextItem:a,tracklistRef:l,fetchTracks:r,addRecommendation:i,removeRecommendation:c,nrTracks:s}){const o=(0,m.useRef)(!1),p=(0,A.k)();(0,m.useEffect)((()=>{var e;o.current&&p&&(null==l||null===(e=l.current)||void 0===e||e.update());o.current=!0}),[p,l]);const y=(0,m.useRef)((()=>{})),[b,v]=(0,m.useState)([]),f=(0,m.useCallback)((()=>{var e;const{firstIndex:t,lastIndex:n}=null==l||null===(e=l.current)||void 0===e?void 0:e.getVisibleTrackWindow(),a=n-t;return Math.max(0,t-Math.round((50-a)/2))}),[l]),g=(0,m.useCallback)((e=>{y.current(),c({itemIds:e.map((({id:e})=>e)),offset:f(),limit:50})}),[c,f]),E=(0,m.useCallback)(((e,t)=>{y.current=t,e.length>1?v(e):g(e)}),[g]),h=(0,m.useCallback)((e=>{i({itemIds:[e],offset:f(),limit:50})}),[i,f]),x=(0,m.useCallback)((e=>{c({itemIds:[e],offset:f(),limit:50})}),[c,f]),I=(0,m.useCallback)((function(e,n){const l=(0,F.X)(e.album.images,{desiredSize:40,desiredLabel:"small"});return d().createElement(se,{key:e.uid,index:n,playIndex:n,contextUri:t,uri:e.uri,uid:e.uid,isPlayable:e.is_playable,durationMs:e.duration_ms,name:e.name,artists:e.artists,album:e.album,isExplicit:e.explicit,isMOGEFRestricted:!!e.mogef19,imgUrl:(null==l?void 0:l.url)||"",usePlayContextItem:a,isEnhanced:e.isEnhanced,add:h,remove:x})}),[a,t,h,x]),k=(0,m.useCallback)((e=>e.uri),[]),w=(0,m.useCallback)((e=>e.uid),[]);return d().createElement(d().Fragment,null,d().createElement(L.ZP,{value:"playlist-tracklist"},d().createElement(Z.Pv,{testID:"playlist-tracklist",key:t,ariaLabel:e,hasHeaderRow:!0,columns:oe,onRemove:E,renderRow:I,resolveUri:k,resolveUid:w,nrTracks:s,fetchTracks:r,limit:50,outerRef:l})),d().createElement(z.h,{title:u.ag.get("playlist.remove_from_playlist",n),isOpen:b.length>0,tracks:b,onClose:e=>{e.stopPropagation(),v([])},onRemove:g}))}));function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function de(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const pe=d().memo((function({metadata:e}){const{uri:t,name:n,images:a,totalLength:l,canPlay:g}=e,[E]=a,h=(0,v.Z)((null==E?void 0:E.url)||null),x=(0,m.useRef)(null),{playContext:I,numTotalItems:k,addRecommendation:w,removeRecommendation:P,fetchTracks:O,stateId:C}=D(t);(0,m.useEffect)((()=>{var e;C&&(null===(e=x.current)||void 0===e||e.update())}),[C]);const{isPlaying:R,togglePlay:j,usePlayContextItem:T}=(0,f.n)(I,{featureIdentifier:"playlist"}),N=(0,m.useCallback)((()=>j()),[j]);return d().createElement(m.Suspense,{fallback:null},d().createElement(c.$,null,u.ag.get("playlist.page-title",n)),d().createElement("section",{role:"presentation",className:S.enhancedPlaylist,"data-testid":"enhanced-playlist-page"},d().createElement(o.s,{metadata:de(de({},e),{},{duration:null,totalLength:null!=k?k:l}),isPlaying:R,togglePlay:N,backgroundColor:h}),d().createElement("div",{className:S.playlistContent},d().createElement(p.o,{backgroundColor:h},d().createElement(p.F,null,g?d().createElement(s.$,{onClick:N,isPlaying:R,size:y.qE.lg,uri:t}):null,d().createElement(M.v,{uri:t}),d().createElement(b.y,{menu:d().createElement(i.X,{uri:t})},d().createElement(r.z,null))))),d().createElement("div",{className:"contentSpacing"},d().createElement(m.Suspense,{fallback:null},d().createElement(ue,{key:t,ariaLabel:n,nrTracks:null!=k?k:Math.max(15,l),uri:t,name:n,usePlayContextItem:T,tracklistRef:x,fetchTracks:O,addRecommendation:w,removeRecommendation:P})))))})),ye=pe}}]);
//# sourceMappingURL=xpui-routes-enhanced-playlist.js.map